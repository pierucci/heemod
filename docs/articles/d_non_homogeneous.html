<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time-varying Markov Models (Non-Homogeneous) • heemod</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Time-varying Markov Models (Non-Homogeneous)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">heemod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_introduction.html">An Introduction to `heemod`</a>
    </li>
    <li>
      <a href="../articles/b_time_dependency.html">Time-varying values</a>
    </li>
    <li>
      <a href="../articles/c_homogeneous.html">Simple Markov Models (Homogeneous)</a>
    </li>
    <li>
      <a href="../articles/d_non_homogeneous.html">Time-varying Markov Models (Non-Homogeneous)</a>
    </li>
    <li>
      <a href="../articles/e_probabilistic.html">Probabilistic Uncertainty Analysis</a>
    </li>
    <li>
      <a href="../articles/f_sensitivity.html">Deterministic Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/g_heterogeneity.html">Heterogeneity &amp; Demographic Analysis</a>
    </li>
    <li>
      <a href="../articles/h_tabular.html">Tabular Input</a>
    </li>
    <li>
      <a href="../articles/i_reproduction.html">Reproducing Exact Results from DMHEE</a>
    </li>
    <li>
      <a href="../articles/j_survival.html">Survival models</a>
    </li>
    <li>
      <a href="../articles/k_calibration.html">Calibrating `heemod` models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Time-varying Markov Models (Non-Homogeneous)</h1>
            
            <h4 class="date">2019-10-22</h4>
      
      
      <div class="hidden name"><code>d_non_homogeneous.Rmd</code></div>

    </div>

    
    
<div id="model-description" class="section level2">
<h2 class="hasAnchor">
<a href="#model-description" class="anchor"></a>Model description</h2>
<p>This example is an implementation of the assessment of a new total hip replacement (THR) technology described in chapter 3.5 of <a href="http://ukcatalogue.oup.com/product/9780198526629.do">Decision Modelling for Health Economic Evaluation</a>. A more detailed report is available <a href="https://www.york.ac.uk/media/che/documents/papers/technicalpapers/CHE%20Technical%20Paper%2028.pdf">at this location</a>. This reports goes a bit further in the analysis. For the sake of simplicity we will not reproduce exactly the analysis from the book. See vignette <code>vignette("i-reproduction", "heemod")</code> for an exact reproduction.</p>
<p>This model has 5 states:</p>
<ul>
<li>Primary THR: starting state, individuals receive either the standard or the new THR (called NP1), outcomes are either success of primary THR or death (the operative mortality rate of primary THR will be called <code>omrPTHR</code>);</li>
<li>Success of primary THR: state after receiving primary THR if the surgery is successfull, individuals can stay in that state, need a THR revision, or die of other causes;</li>
<li>Revision of primary THR: for individuals whose primary THR needed revision, outcomes are either success of revision THR or death (the operative mortality rate of revision THR will be called <code>omrRTHR</code>);</li>
<li>Success of revision THR: state after receiving revision THR if the surgery is successfull, individuals can stay in that state, need a THR re-revision, or die of other causes;</li>
<li>Death (either caused by THR or another cause).</li>
</ul>
<p>Two transition probabilities are time-varying in this model:</p>
<ul>
<li>Probability of death by another cause increases with age;</li>
<li>Probability of primary THR revision changes with time.</li>
</ul>
</div>
<div id="other-cause-death" class="section level2">
<h2 class="hasAnchor">
<a href="#other-cause-death" class="anchor"></a>Other-Cause death</h2>
<p>Other-cause death probabilities (mortality rate <code>mr</code>) for the United Kingdom is taken from WHO databases using the <code><a href="../reference/who_mortality.html">get_who_mr()</a></code> function. The variable <code>sex</code>, taking values <code>0</code> and <code>1</code>, must be recoded in <code>"FMLE"</code> and <code>"MLE"</code> before being passed to this function.</p>
</div>
<div id="thr-revision" class="section level2">
<h2 class="hasAnchor">
<a href="#thr-revision" class="anchor"></a>THR revision</h2>
<ul>
<li>Primary THR revision probability for the standard THR, called <code>standardRR</code> increases with time with the following formula (a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull distribution</a>):</li>
</ul>
<p><span class="math display">\[
P_{revision} = 1 - \exp(\lambda \times ((t-1)^\gamma-t^\gamma))
\]</span></p>
<p>Where <span class="math inline">\(t\)</span> is the time since revision, <span class="math inline">\(\gamma = 1.45367786\)</span> and:</p>
<p><span class="math display">\[
\lambda = exp(cons + ageC \times age + maleC \times sex)
\]</span></p>
<p>Where <span class="math inline">\(age\)</span> and <span class="math inline">\(sex\)</span> (female = <em>0</em>, male = <em>1</em>) are individual characteristics, <span class="math inline">\(cons = -5.49094\)</span>, <span class="math inline">\(ageC = -0.0367\)</span> and <span class="math inline">\(maleC = 0.768536\)</span>.</p>
<ul>
<li>For the NP1 procedure the standard procedure revision probability <code>standardRR</code> is modified by the relative risk <span class="math inline">\(rrNP1 = 0.260677\)</span>.</li>
</ul>
<p><span class="math display">\[
P_{revision} = 1 - \exp(\lambda \times rr \times NP1 \times ((t-1)^\gamma-t^\gamma))
\]</span></p>
<ul>
<li>Revision THR re-revision (<code>rrr</code>) probability is set to be constant at <em>0.04</em> per year.</li>
</ul>
</div>
<div id="parameter-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#parameter-definition" class="anchor"></a>Parameter definition</h2>
<p>The key element to specify time-varying elements in <code>heemod</code> is through the use of the <strong>package-defined variables</strong> <code>markov_cycle</code> and <code>state_cycle</code>. See vignette <code>vignette("b-time-dependency", "heemod")</code> for more details.</p>
<p>In order to build this more complex Markov model, parameters need to be defined through <code><a href="../reference/define_parameters.html">define_parameters()</a></code> (for 2 reasons: to keep the transition matrix readable, and to avoid repetition by re-using parameters between strategies).</p>
<p>The equations decribed in the previous section can be written easily, here for a female population (<code>sex</code> = <em>0</em>) starting at 60 years old (<code>age_init</code> = <em>60</em>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">param &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_parameters.html">define_parameters</a></span>(</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    <span class="dt">age_init =</span> <span class="dv">60</span>,</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="dt">sex =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="co"># age increases with cycles</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="dt">age =</span> age_init <span class="op">+</span><span class="st"> </span>markov_cycle,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="co"># operative mortality rates</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="dt">omrPTHR =</span> <span class="fl">.02</span>,</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="dt">omrRTHR =</span> <span class="fl">.02</span>,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="co"># re-revision mortality rate</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="dt">rrr =</span> <span class="fl">.04</span>,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">    <span class="co"># parameters for calculating primary revision rate</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">    <span class="dt">cons =</span> <span class="fl">-5.49094</span>,</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    <span class="dt">ageC =</span> <span class="fl">-.0367</span>,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    <span class="dt">maleC =</span> <span class="fl">.768536</span>,</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    <span class="dt">lambda =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(cons <span class="op">+</span><span class="st"> </span>ageC <span class="op">*</span><span class="st"> </span>age_init <span class="op">+</span><span class="st"> </span>maleC <span class="op">*</span><span class="st"> </span>sex),</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    <span class="dt">gamma =</span> <span class="fl">1.45367786</span>,</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    </a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    <span class="dt">rrNP1 =</span> <span class="fl">.260677</span>,</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    </a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    <span class="co"># revision probability of primary procedure</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="dt">standardRR =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(lambda <span class="op">*</span><span class="st"> </span>((markov_cycle <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">^</span><span class="st"> </span>gamma <span class="op">-</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="st">                                     </span>markov_cycle <span class="op">^</span><span class="st"> </span>gamma)),</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    <span class="dt">np1RR =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(lambda <span class="op">*</span><span class="st"> </span>rrNP1 <span class="op">*</span><span class="st"> </span>((markov_cycle <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">^</span><span class="st"> </span>gamma <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="st">                                        </span>markov_cycle <span class="op">^</span><span class="st"> </span>gamma)),</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    </a>
<a class="sourceLine" id="cb1-30" data-line-number="30">    <span class="co"># age-related mortality rate</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    <span class="dt">sex_cat =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(sex <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">"FMLE"</span>, <span class="st">"MLE"</span>),</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">    <span class="dt">mr =</span> <span class="kw"><a href="../reference/who_mortality.html">get_who_mr</a></span>(age, sex_cat, <span class="dt">country =</span> <span class="st">"GBR"</span>, <span class="dt">local =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    </a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    <span class="co"># state values</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">    <span class="dt">u_SuccessP =</span> <span class="fl">.85</span>,</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">    <span class="dt">u_RevisionTHR =</span> <span class="fl">.30</span>,</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    <span class="dt">u_SuccessR =</span> <span class="fl">.75</span>,</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">    <span class="dt">c_RevisionTHR =</span> <span class="dv">5294</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">param</a></code></pre></div>
<pre><code>## 20 unevaluated parameters.
## 
## age_init = 60
## sex = 0
## age = age_init + markov_cycle
## omrPTHR = 0.02
## omrRTHR = 0.02
## rrr = 0.04
## cons = -5.49094
## ageC = -0.0367
## maleC = 0.768536
## lambda = exp(cons + ageC * age_init + maleC * sex)
## gamma = 1.45367786
## rrNP1 = 0.260677
## standardRR = 1 - exp(lambda * ((markov_cycle - 1)^gamma - markov_cycle^gamma))
## np1RR = 1 - exp(lambda * rrNP1 * ((markov_cycle - 1)^gamma - markov_cycle^gamma))
## sex_cat = ifelse(sex == 0, "FMLE", "MLE")
## mr = get_who_mr(age, sex_cat, country = "GBR", local = TRUE)
## u_SuccessP = 0.85
## u_RevisionTHR = 0.3
## u_SuccessR = 0.75
## c_RevisionTHR = 5294</code></pre>
</div>
<div id="transition-matrix-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#transition-matrix-definition" class="anchor"></a>Transition matrix definition</h2>
<p>Now that parameters are defined, the probability transitions can be easily written:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mat_standard &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_transition.html">define_transition</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="dt">state_names =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">      <span class="st">"PrimaryTHR"</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">      <span class="st">"SuccessP"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">      <span class="st">"RevisionTHR"</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      <span class="st">"SuccessR"</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">      <span class="st">"Death"</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    ),</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="dv">0</span>, C, <span class="dv">0</span>,          <span class="dv">0</span>, omrPTHR,</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="dv">0</span>, C, standardRR, <span class="dv">0</span>, mr,</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          C, omrRTHR<span class="op">+</span>mr,</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    <span class="dv">0</span>, <span class="dv">0</span>, rrr,        C, mr,</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          <span class="dv">0</span>, <span class="dv">1</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">mat_standard</a></code></pre></div>
<pre><code>## A transition matrix, 5 states.
## 
##             PrimaryTHR SuccessP RevisionTHR SuccessR Death       
## PrimaryTHR             C                             omrPTHR     
## SuccessP               C        standardRR           mr          
## RevisionTHR                                 C        omrRTHR + mr
## SuccessR                        rrr         C        mr          
## Death                                                1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mat_np1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_transition.html">define_transition</a></span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    <span class="dt">state_names =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">      <span class="st">"PrimaryTHR"</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">      <span class="st">"SuccessP"</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">      <span class="st">"RevisionTHR"</span>,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">      <span class="st">"SuccessR"</span>,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">      <span class="st">"Death"</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    ),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="dv">0</span>, C, <span class="dv">0</span>,          <span class="dv">0</span>, omrPTHR,</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    <span class="dv">0</span>, C, np1RR,      <span class="dv">0</span>, mr,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          C, omrRTHR<span class="op">+</span>mr,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    <span class="dv">0</span>, <span class="dv">0</span>, rrr,        C, mr,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          <span class="dv">0</span>, <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">mat_np1</a></code></pre></div>
<pre><code>## A transition matrix, 5 states.
## 
##             PrimaryTHR SuccessP RevisionTHR SuccessR Death       
## PrimaryTHR             C                             omrPTHR     
## SuccessP               C        np1RR                mr          
## RevisionTHR                                 C        omrRTHR + mr
## SuccessR                        rrr         C        mr          
## Death                                                1</code></pre>
<p>While it is possible to plot the matrix thanks to the <code>diagram</code> package, the results may not always be easy to read.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mat_standard)</a></code></pre></div>
<pre><code>## Le chargement a nécessité le package : diagram</code></pre>
<p><img src="d_non_homogeneous_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="state-strategy-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#state-strategy-definition" class="anchor"></a>State &amp; strategy definition</h2>
<p>Utilities and costs are then associated to states. In this model costs are discounted at a rate of 6% and utilities at a rate of 1.5%.</p>
<p>Now that parameters, transition matrix and states are defined we can define the strategies for the control group and the NP1 treatment.</p>
<p>We use <code><a href="../reference/define_starting_values.html">define_starting_values()</a></code> to take into account the cost of surgery.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">strat_standard &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_strategy.html">define_strategy</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">transition =</span> mat_standard,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">PrimaryTHR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="dt">utility =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">SuccessP =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_SuccessP, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  ),</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="dt">RevisionTHR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_RevisionTHR, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    <span class="dt">cost =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(c_RevisionTHR, <span class="fl">.06</span>)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">  <span class="dt">SuccessR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_SuccessR, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18">  ),</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">  <span class="dt">Death =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">    <span class="dt">utility =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">  ),</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">  <span class="dt">starting_values =</span> <span class="kw"><a href="../reference/define_starting_values.html">define_starting_values</a></span>(</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">    <span class="dt">cost =</span> <span class="dv">394</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25">  )</a>
<a class="sourceLine" id="cb9-26" data-line-number="26">)</a>
<a class="sourceLine" id="cb9-27" data-line-number="27">strat_standard</a></code></pre></div>
<pre><code>## A Markov model strategy:
## 
##     5 states,
##     2 state values</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">strat_np1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_strategy.html">define_strategy</a></span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">transition =</span> mat_np1,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">PrimaryTHR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    <span class="dt">utility =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">SuccessP =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_SuccessP, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  ),</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="dt">RevisionTHR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_RevisionTHR, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    <span class="dt">cost =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(c_RevisionTHR, <span class="fl">.06</span>)</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">  <span class="dt">SuccessR =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    <span class="dt">utility =</span> <span class="kw"><a href="../reference/discount.html">discount</a></span>(u_SuccessR, <span class="fl">.015</span>),</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  ),</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  <span class="dt">Death =</span> <span class="kw"><a href="../reference/define_state.html">define_state</a></span>(</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">    <span class="dt">utility =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">    <span class="dt">cost =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">  ),</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">  <span class="dt">starting_values =</span> <span class="kw"><a href="../reference/define_starting_values.html">define_starting_values</a></span>(</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">    <span class="dt">cost =</span> <span class="dv">579</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25">  )</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">)</a>
<a class="sourceLine" id="cb11-27" data-line-number="27">strat_np1</a></code></pre></div>
<pre><code>## A Markov model strategy:
## 
##     5 states,
##     2 state values</code></pre>
</div>
<div id="model-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#model-analysis" class="anchor"></a>Model analysis</h2>
<p>Both strategies can now be run for 60 years. By default models are computed for 1000 person starting in <code>PrimaryTHR</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">res_mod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_model.html">run_model</a></span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">standard =</span> strat_standard,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">np1      =</span> strat_np1,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">parameters =</span> param,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="dt">cycles =</span> <span class="dv">60</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="dt">cost =</span> cost,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="dt">effect =</span> utility</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">)</a></code></pre></div>
<pre><code>## Fetching mortality data from package cached data.</code></pre>
<pre><code>## Using cached data from year 2015.</code></pre>
<p>A comparison of both strategies can be done with <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>. The incremental cost and effect are displayed in columns <code>Cost</code> and <code>Effect</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(res_mod)</a></code></pre></div>
<pre><code>## 2 strategies run for 60 cycles.
## 
## Initial state counts:
## 
## PrimaryTHR = 1000L
## SuccessP = 0L
## RevisionTHR = 0L
## SuccessR = 0L
## Death = 0L
## 
## Counting method: 'life-table'.
## 
## Values:
## 
##           utility     cost
## standard 16239.62 529400.8
## np1      16291.79 614827.1
## 
## Efficiency frontier:
## 
## standard -&gt; np1
## 
## Differences:
## 
##     Cost Diff. Effect Diff.     ICER     Ref.
## np1   85.42637   0.05216416 1637.645 standard</code></pre>
<p>The new treatment costs £1638 more per QALY gained.</p>
<p>It should be noted that this result differs from the original study. This difference is explained by higher population-level all-causes mortality rates in the original study than in the WHO database (used here). See vignette <code>vignette("i-reproduction", "heemod")</code> for an exact reproduction of the analysis.</p>
<p>We can plot the counts per state:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res_mod, <span class="dt">type =</span> <span class="st">"counts"</span>, <span class="dt">panel =</span> <span class="st">"by_state"</span>, <span class="dt">free_y =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_brewer</span>(</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    <span class="dt">name =</span> <span class="st">"Strategy"</span>,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="dt">palette =</span> <span class="st">"Set1"</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  )</a></code></pre></div>
<pre><code>## Scale for 'colour' is already present. Adding another scale for
## 'colour', which will replace the existing scale.</code></pre>
<p><img src="d_non_homogeneous_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#model-description">Model description</a></li>
      <li><a href="#other-cause-death">Other-Cause death</a></li>
      <li><a href="#thr-revision">THR revision</a></li>
      <li><a href="#parameter-definition">Parameter definition</a></li>
      <li><a href="#transition-matrix-definition">Transition matrix definition</a></li>
      <li><a href="#state-strategy-definition">State &amp; strategy definition</a></li>
      <li><a href="#model-analysis">Model analysis</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Zarca, Antoine Filipovic-Pierucci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
